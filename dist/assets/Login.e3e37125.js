import{I as p}from"./Input.9024e7e0.js";import{u as me,r as i,c as _e,d as ge,e as fe,f as m,a as n,j as _,R as S,H as he,z as ve,B as be}from"./index.30f654d1.js";import{u as g,p as k,e as ke}from"./useInputValidator.92ae746a.js";import{u as f}from"./useHTTP.95e3c505.js";import{u as Ce}from"./useDispatch.e7edbe39.js";const Ie="_actions_fr6tl_11",Ne="_toggler_fr6tl_37",He="_invalid_fr6tl_67",Ee="_error_fr6tl_99",xe="_email_fr6tl_117",Be="_password_fr6tl_119",o={"login-form":"_login-form_fr6tl_1",actions:Ie,toggler:Ne,invalid:He,error:Ee,email:xe,password:Be,"server-error":"_server-error_fr6tl_143","server-success":"_server-success_fr6tl_175","server-loading":"_server-loading_fr6tl_207"},Ue=Re=>{const h=Ce(),q=me(),[a,C]=i.exports.useState(!0),[I,D]=i.exports.useState(null),[j,T]=i.exports.useState(!1),O=i.exports.useCallback(e=>{const t=[];for(let s in e){const r={};r.id=e[s].account_id,r.account_no=e[s].account_no,r.active=e[s].active?"Yes":"No",r.joint=e[s].joint?"Yes":"No",r.bank_name=e[s].bank_dets.bank_name,t.push(r)}h(_e.setUserAccounts({accounts:t}))},[]),z=i.exports.useCallback(e=>{const t=[];for(let s in e){const r={};r.bal_col=e[s].bal_col,r.id=e[s].bank_id,r.bank_name=e[s].bank_name,r.chq_no_col=e[s].chq_no_col,r.crdt_amt_col=e[s].crdt_amt_col,r.start_row=e[s].start_row,r.txn_date_col=e[s].txn_date_col,r.txn_rmrk_col=e[s].txn_rmrk_col,r.val_date_col=e[s].val_date_col,r.with_amt_col=e[s].with_amt_col,r.date_format=e[s].date.date_format,t.push(r)}h(ge.setBanks({banks:t}))},[]),{sendRequest:Y}=f(O),{sendRequest:F}=f(z),M=i.exports.useCallback(e=>{T(!0),h(fe.logUserIn({authToken:e.access_token,isAdmin:e.admin,expiresIn:e.expires_in}));const t={url:m+"/accounts",headers:{Authorization:"Bearer "+e.access_token}};Y(t);const s={url:m+"/banks",headers:{Authorization:"Bearer "+e.access_token}};F(s),q.replace("/")},[]),{isloading:l,error:N,sendRequest:G,resetError:J}=f(M),K=i.exports.useCallback(e=>{D("Registration successful! Your User Id is "+e.user_id),C(!0)},[]),{isloading:H,error:v,sendRequest:Q,resetError:W}=f(K),{inputValue:E,inputIsValid:X,isError:Z,inputBlurHandler:$,inputChangeHandler:ee,resetInput:x}=g(k),{inputValue:b,inputIsValid:B,isError:se,inputBlurHandler:re,inputChangeHandler:ne,resetInput:R}=g(ke),{inputValue:c,inputIsValid:V,isError:oe,inputBlurHandler:te,inputChangeHandler:ae,resetInput:w}=g(k),{inputValue:y,inputIsValid:ie,isError:P,inputBlurHandler:le,inputChangeHandler:ce,resetInput:L}=g(k),de=()=>{C(e=>!e)},ue=e=>{if(e.preventDefault(),a){J();const t={url:m+"/userlogin",method:"POST",headers:{"Content-Type":"application/json"},body:{email_id:b,password:c}};G(t),w(),R()}else{W();const t={url:m+"/registration",method:"POST",headers:{"Content-Type":"application/json"},body:{user_name:E,email_id:b,password:c}};Q(t),w(),x(),R(),L()}};let U=c===y,A=B&&V&&ie&&U&&X,pe=P||!U;a&&(A=B&&V);let d;a?l?d="Logging In...":d="Login":d="Register";let u;return H&&(u=n("div",{className:o["server-loading"],children:"Setting up your account..."})),v&&(u=n("div",{className:o["server-error"],children:v})),!H&&!v&&I&&(u=n("div",{className:o["server-success"],children:I})),i.exports.useEffect(()=>{a&&(L(),x())},[a]),i.exports.useEffect(()=>{},[j]),_(S.Fragment,{children:[n(he,{children:a?"Login":"Register"}),n(ve,{children:_("form",{onSubmit:ue,className:o["login-form"],children:[!a&&n(p,{id:"username",type:"text",name:"username",value:E,onBlur:$,onChange:ee,disabled:l,className:Z?o.invalid:"",children:"User Name"}),n(p,{id:"email",type:"email",name:"email",value:b,onBlur:re,onChange:ne,disabled:l,className:se?o.invalid:"",children:"Email Id"}),n(p,{id:"password",type:"password",name:"password",value:c,onBlur:te,onChange:ae,disabled:l,className:oe?o.invalid:"",children:"Password"}),!a&&_(S.Fragment,{children:[n(p,{id:"confpassword",type:"password",name:"confpassword",value:y,onBlur:le,onChange:ce,disabled:l,className:P?o.invalid:"",children:"Confirm Password"}),pe&&n("p",{className:o.error,children:"Passwords Dont Match"})]}),_("div",{className:o.actions,children:[n(be,{type:"submit",disabled:!A,children:d}),n("button",{type:"button",onClick:de,className:o.toggler,children:a?"New User?":"Existing User Login"})]}),N&&n("p",{className:o.error,children:N})]})}),u]})};export{Ue as default};
