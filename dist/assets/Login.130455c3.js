import{I as p}from"./Input.929f1c40.js";import{u as me,r as i,c as _e,d as ge,e as he,f as m,a as o,j as _,R as S,H as fe,z as ve,B as be}from"./index.a05e5750.js";import{u as g,p as k,e as ke}from"./useInputValidator.5f963b09.js";import{u as h}from"./useHTTP.b23999b0.js";import{u as Ce}from"./useDispatch.4fe1ca73.js";const Ie="_actions_1oa8l_6",Ne="_toggler_1oa8l_19",He="_invalid_1oa8l_34",Ee="_error_1oa8l_50",xe="_email_1oa8l_59",Be="_password_1oa8l_60",n={"login-form":"_login-form_1oa8l_1",actions:Ie,toggler:Ne,invalid:He,error:Ee,email:xe,password:Be,"server-error":"_server-error_1oa8l_72","server-success":"_server-success_1oa8l_88","server-loading":"_server-loading_1oa8l_104"},Ue=Re=>{const f=Ce(),q=me(),[a,C]=i.exports.useState(!0),[I,D]=i.exports.useState(null),[j,T]=i.exports.useState(!1),O=i.exports.useCallback(e=>{const t=[];for(let s in e){const r={};r.id=e[s].account_id,r.account_no=e[s].account_no,r.active=e[s].active?"Yes":"No",r.joint=e[s].joint?"Yes":"No",r.bank_name=e[s].bank_dets.bank_name,t.push(r)}f(_e.setUserAccounts({accounts:t}))},[]),z=i.exports.useCallback(e=>{const t=[];for(let s in e){const r={};r.bal_col=e[s].bal_col,r.id=e[s].bank_id,r.bank_name=e[s].bank_name,r.chq_no_col=e[s].chq_no_col,r.crdt_amt_col=e[s].crdt_amt_col,r.start_row=e[s].start_row,r.txn_date_col=e[s].txn_date_col,r.txn_rmrk_col=e[s].txn_rmrk_col,r.val_date_col=e[s].val_date_col,r.with_amt_col=e[s].with_amt_col,r.date_format=e[s].date.date_format,t.push(r)}f(ge.setBanks({banks:t}))},[]),{sendRequest:Y}=h(O),{sendRequest:F}=h(z),M=i.exports.useCallback(e=>{T(!0),f(he.logUserIn({authToken:e.access_token,isAdmin:e.admin,expiresIn:e.expires_in}));const t={url:m+"/accounts",headers:{Authorization:"Bearer "+e.access_token}};Y(t);const s={url:m+"/banks",headers:{Authorization:"Bearer "+e.access_token}};F(s),q.replace("/")},[]),{isloading:l,error:N,sendRequest:G,resetError:J}=h(M),K=i.exports.useCallback(e=>{D("Registration successful! Your User Id is "+e.user_id),C(!0)},[]),{isloading:H,error:v,sendRequest:Q,resetError:W}=h(K),{inputValue:E,inputIsValid:X,isError:Z,inputBlurHandler:$,inputChangeHandler:ee,resetInput:x}=g(k),{inputValue:b,inputIsValid:B,isError:se,inputBlurHandler:re,inputChangeHandler:oe,resetInput:R}=g(ke),{inputValue:c,inputIsValid:V,isError:ne,inputBlurHandler:te,inputChangeHandler:ae,resetInput:w}=g(k),{inputValue:y,inputIsValid:ie,isError:P,inputBlurHandler:le,inputChangeHandler:ce,resetInput:L}=g(k),de=()=>{C(e=>!e)},ue=e=>{if(e.preventDefault(),a){J();const t={url:m+"/userlogin",method:"POST",headers:{"Content-Type":"application/json"},body:{email_id:b,password:c}};G(t),w(),R()}else{W();const t={url:m+"/registration",method:"POST",headers:{"Content-Type":"application/json"},body:{user_name:E,email_id:b,password:c}};Q(t),w(),x(),R(),L()}};let U=c===y,A=B&&V&&ie&&U&&X,pe=P||!U;a&&(A=B&&V);let d;a?l?d="Logging In...":d="Login":d="Register";let u;return H&&(u=o("div",{className:n["server-loading"],children:"Setting up your account..."})),v&&(u=o("div",{className:n["server-error"],children:v})),!H&&!v&&I&&(u=o("div",{className:n["server-success"],children:I})),i.exports.useEffect(()=>{a&&(L(),x())},[a]),i.exports.useEffect(()=>{},[j]),_(S.Fragment,{children:[o(fe,{children:a?"Login":"Register"}),o(ve,{children:_("form",{onSubmit:ue,className:n["login-form"],children:[!a&&o(p,{id:"username",type:"text",name:"username",value:E,onBlur:$,onChange:ee,disabled:l,className:Z?n.invalid:"",children:"User Name"}),o(p,{id:"email",type:"email",name:"email",value:b,onBlur:re,onChange:oe,disabled:l,className:se?n.invalid:"",children:"Email Id"}),o(p,{id:"password",type:"password",name:"password",value:c,onBlur:te,onChange:ae,disabled:l,className:ne?n.invalid:"",children:"Password"}),!a&&_(S.Fragment,{children:[o(p,{id:"confpassword",type:"password",name:"confpassword",value:y,onBlur:le,onChange:ce,disabled:l,className:P?n.invalid:"",children:"Confirm Password"}),pe&&o("p",{className:n.error,children:"Passwords Dont Match"})]}),_("div",{className:n.actions,children:[o(be,{type:"submit",disabled:!A,children:d}),o("button",{type:"button",onClick:de,className:n.toggler,children:a?"New User?":"Existing User Login"})]}),N&&o("p",{className:n.error,children:N})]})}),u]})};export{Ue as default};
